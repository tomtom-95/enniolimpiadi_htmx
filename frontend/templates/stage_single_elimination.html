<div id="stage-bracket-content">
    {% set rounds = stage.rounds %}
    {% if rounds %}
    {% set first_round_matches = rounds[0].matches | length %}
    {% set total_rows = first_round_matches * 2 %}
    {% set num_rounds = rounds | length %}

    <div class="stage-bracket" style="grid-template-columns: repeat({{ num_rounds }}, 150px); grid-template-rows: repeat({{ total_rows }}, 1fr);">
        {% for round in rounds %}
            {% set r = loop.index0 %}
            {% for match in round.matches %}
                {% set m = loop.index0 %}
                {% set row_start = m * (2 ** (r + 1)) + (2 ** r) %}
                <div class="bracket-match"
                     style="grid-column: {{ r + 1 }}; grid-row: {{ row_start }} / span 2;">
                    <div class="bracket-participant bracket-top">{{ match.p1 }}</div>
                    <div class="bracket-score">{{ match.score }}</div>
                    <div class="bracket-participant bracket-bottom">{{ match.p2 }}</div>
                </div>
            {% endfor %}
        {% endfor %}
    </div>
    {% else %}
    <p>Nessun incontro in questa fase.</p>
    {% endif %}
</div>
